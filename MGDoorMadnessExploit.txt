
local ClickDetectors = {}

-- These variables handle the Bunker Door Shenanigans
local BunkerDoor, LockButton, LockButtonClickDetector

-- Previous versions of the Door Madness script iterates through the entire baseplate every 0.1 seconds for the Door ClickDetectors. We can achieve a more optimized approach by only iterating through the baseplate once and keeping track of all the Door ClickDetectors inside an array
function GetClickDetectors()
	
	local FoundBananaLabDoor = false
	local FoundBunkerStuff = false
	
	for i,v in ipairs(workspace:GetChildren()) do
		
		-- All the doors have the same name and children structure to each other. Which makes keeping track alot easier!
		if v.Name == "Door" or v.Name == "SwingDoor" then
			table.insert(ClickDetectors, v.RealDoor.ClickDetector)
			
		-- The Banana Lab sliding door is parented in a model named "Model" which makes this process harder
		elseif not FoundBananaLabDoor and v.Name == "Model" then
			local FindDoor = v:FindFirstChild("Door")
			
			if FindDoor then
				table.insert(ClickDetectors, FindDoor.RealDoor.ClickDetector)
				FoundBananaLabDoor = true
			end
			
		-- Fortunately for us! The Bunker Door and all the neccesities are neatly packed in a Folder named "BunkerDoor"
		elseif not FoundBunkerStuff and v.Name == "BunkerDoor" then
			BunkerDoor = v.Model.ClickDetector
			LockButton = v.Lockbutton.But
			LockButtonClickDetector = v.Lockbutton.ClickDetector
			
			FoundBunkerStuff = true
			
		end
	end
end

spawn(function()
	
	-- Gets all the ClickDetectors and puts them in the list. Also references BunkerDoor, LockButton, and LockButtonClickDetector
	GetClickDetectors()
	
	-- Mainly for Debugging
	-- print(ClickDetectors, BunkerDoor, LockButton, LockButtonClickDetector)
	
	while task.wait(0.1) do
		
		-- Fires every door listed in ClickDetectors
		for i=1, #ClickDetectors do
			fireclickdetector(ClickDetectors[i])
		end
		
		-- Checks if the Bunker Lock is on. If so, disables the lock
		if LockButton.BrickColor == BrickColor.new("Bright red") then
			fireclickdetector(LockButtonClickDetector)
		end
		
		-- Opens the Bunker Door
		fireclickdetector(BunkerDoor)
	end
end)
